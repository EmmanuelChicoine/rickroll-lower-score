name: 'Random RickRoll'
branding:
  icon: 'message-circle'  
  color: 'blue'
description: 'Rick-roll when mutation test score decreases.'
inputs: 
  GITHUB_TOKEN:
    description: 'Github token of the repository'
    required: false
    default: '${{ github.token }}'
  new_score:
    description: 'New mutation score'
    required: true
  previous_score:
    description: 'Previous mutation score'
    required: false
    default: '0.00'
runs:
  using: 'composite'
  steps:
    - name: Compare scores and RickRoll
      shell: bash
      run: |
        NEW_SCORE=${{ inputs.new_score }}
        PREV_SCORE=${{ inputs.previous_score }}
        
        echo "ðŸ“Š Scores de mutation:"
        echo "  PrÃ©cÃ©dent: $PREV_SCORE"
        echo "  Nouveau: $NEW_SCORE"
        
        # Comparaison des scores (utilise bc pour les nombres dÃ©cimaux)
        if (( $(echo "$NEW_SCORE < $PREV_SCORE" | bc -l) )); then
          echo "âŒ Le score a baissÃ©!"
          echo -e "\nðŸŽµ Never gonna give you up... ðŸŽµ\n"
          echo "Voir les dÃ©tails : https://user-images.githubusercontent.com/37572049/90699500-0cc3ec00-e2a1-11ea-8d13-989526e86b0e.gif"
          exit 1
        else
          echo "âœ… Le score est maintenu ou amÃ©liorÃ©!"
        fi